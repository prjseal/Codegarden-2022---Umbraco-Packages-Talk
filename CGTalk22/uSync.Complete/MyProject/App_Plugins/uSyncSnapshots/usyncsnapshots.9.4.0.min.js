!function(){"use strict";var createSnapshotComponent={templateUrl:Umbraco.Sys.ServerVariables.application.applicationPath+"App_Plugins/uSyncSnapshots/components/createComponent.html",controllerAs:"vm",controller:function($rootScope,$q,$scope,uSync8DashboardService,uSyncSnapshotService,eventsService,notificationsService,uSyncHub){var vm=this;function init(){vm.working=!1,vm.reported=!1,vm.result="",vm.create=createSnapshot,vm.snapshot={name:"",includeFolders:!0}}function createSnapshot(group,isFull){vm.createButton.state="busy",vm.working=!0,vm.reported=!1,vm.result="";var defer,promises=[(defer=$q.defer(),uSyncHub.initHub(function(hub){vm.hub=hub,vm.hub.on("add",function(data){vm.status=data}),vm.hub.on("update",function(update){vm.update=update}),vm.hub.start(function(result){defer.resolve("complete "+result)})}),defer.promise)];$q.all(promises).then(function(){console.log("starting"),uSyncSnapshotService.createSnapshot(vm.snapshot.name,vm.snapshot.includeFolders,group,isFull,void 0===$.connection?"":$.connection.connectionId).then(function(result){vm.createButton.state="success",vm.reported=!0,0===result.data.fileCount?vm.result="Empty Snapshot, no changes detected":vm.result="Snapshot created "+result.data.fileCount+" changes captured",$rootScope.$broadcast("usync-snapshot-reloaded"),notificationsService.success("complete","snapshot created")},function(error){vm.working=!1,vm.createButton.state="error",notificationsService.error("failed",error.data.exceptionMessage)})})}vm.createButton={state:"init",defaultButton:{labelKey:"usync_create-snapshot",handler:function(){createSnapshot("")}},subButtons:[]},vm.$onInit=function(){uSync8DashboardService.getHandlerGroups().then(function(result){_.forEach(result.data,function(group,key){key.startsWith("_")||vm.createButton.subButtons.push({handler:function(){createSnapshot(group,!1)},labelKey:"usync_create-"+key.toLowerCase()})}),vm.createButton.subButtons.push({handler:function(){createSnapshot("",!0)},labelKey:"usync_create-full"})}),init()};var evts=[];evts.push(eventsService.on("usync-snapshot.tab.change",function(event){vm.reported&&init()})),$scope.$on("$destroy",function(){for(var e in evts)eventsService.unsubscribe(evts[e])})}};angular.module("umbraco").component("usyncSnapshotCreate",createSnapshotComponent)}(),function(){"use strict";var listSnapshotsComponent={templateUrl:Umbraco.Sys.ServerVariables.application.applicationPath+"App_Plugins/uSyncSnapshots/components/listSnapshotsComponent.html",controllerAs:"vm",controller:function($scope,$rootScope,$q,uSyncSnapshotService,uSyncHub,uSyncExpansionService,notificationsService,editorService){var vm=this;vm.loading=!0,vm.snapshots=[],vm.importDisabled=Umbraco.Sys.ServerVariables.uSyncSnapshots.importDisabled,vm.getSnapshots=getSnapshots,vm.remove=function(alias){vm.loading=!0,uSyncSnapshotService.remove(alias).then(function(result){getSnapshots()},function(error){vm.working=!1,notificationsService.error("error",error.data.ExceptionMessage)})},vm.apply=function(alias){vm.working=!0,vm.reported=!1,vm.action="Import",uSyncSnapshotService.apply(alias,getClientId()).then(function(result){vm.working=!1,vm.reported=!0,vm.results=result.data,$rootScope.$broadcast("usync-snapshot-reloaded")},function(error){vm.working=!1,notificationsService.error("Error",error.data.ExceptionMessage)})},vm.download=function(alias){uSyncSnapshotService.download(alias).then(function(result){vm.buttonState="success"},function(error){vm.buttonState="error",notificationsService.error("error",error.data.ExceptionMessage)})},vm.downloadAll=function(){uSyncSnapshotService.downloadAll().then(function(result){vm.buttonState="success"},function(error){vm.buttonState="error",notificationsService.error("error",error.data.ExceptionMessage)})},vm.importDialog=function(){editorService.open({title:"Import Snapshot File",view:"/App_Plugins/uSyncSnapshots/dialog/importDialog.html",size:"small",submit:function(done){editorService.close(),$rootScope.$broadcast("usync-snapshot-reloaded")},close:function(){editorService.close()}})},vm.applyAll=function(){vm.working=!0,vm.reported=!1,vm.action="Import",uSyncSnapshotService.applyAll(getClientId()).then(function(result){vm.working=!1,vm.reported=!0,vm.results=result.data,$rootScope.$broadcast("usync-snapshot-reloaded")},function(error){vm.working=!1,notificationsService.error("Error",error.data.ExceptionMessage)})},vm.report=function(alias){vm.working=!0,vm.reported=!1,vm.action="Report",uSyncSnapshotService.report(alias,getClientId()).then(function(result){vm.working=!1,vm.reported=!0,vm.results=result.data},function(error){vm.working=!1,notificationsService.error("error",error.data.ExceptionMessage)})},vm.reportAll=function(){vm.working=!0,vm.reported=!1,vm.action="Report",uSyncSnapshotService.reportAll(getClientId()).then(function(result){vm.working=!1,vm.reported=!0,vm.results=result.data},function(error){vm.working=!1,notificationsService.error("error",error.data.ExceptionMessage)})},vm.working=!1,vm.action="report",vm.results=[],vm.reported=!1,vm.licenced=!0;var promises=[];function getSnapshots(){uSyncSnapshotService.getSnapshots().then(function(result){vm.snapshots=result.data,vm.loading=!1})}function getClientId(){return void 0!==$.connection?$.connection.connectionId:""}promises.push(function(){var defer=$q.defer();return uSyncHub.initHub(function(hub){vm.hub=hub,vm.hub.on("add",function(data){vm.status=data}),vm.hub.on("update",function(update){vm.update=update}),vm.hub.start(function(result){defer.resolve("complete "+result)})}),defer.promise}()),$q.all(promises).then(function(){getSnapshots()}),$scope.$on("usync-snapshot-reloaded",function(){vm.getSnapshots()}),vm.$onInit=function(){uSyncExpansionService.isLicenced("snapshots","8.0.0").then(function(result){vm.licenced=result.data})}}};angular.module("umbraco").component("usyncSnapshotsList",listSnapshotsComponent)}(),function(){"use strict";angular.module("umbraco").controller("uSyncSnapshotSettingsController",function($scope,uSyncSnapshotService,notificationsService){var vm=this;vm.loading=!0,vm.settings={folders:"scripts,views,css"},vm.buttonState="init",vm.saveSettings=function(){vm.buttonState="busy",uSyncSnapshotService.saveSettings(vm.settings).then(function(result){notificationsService.success("Saved","Settings Saved"),vm.buttonState="success"},function(error){notificationsService.error("Error",error.data.ExceptionMessage),vm.buttonState="error"})},uSyncSnapshotService.getSettings().then(function(settings){vm.settings=settings.data,vm.loading=!1,settings=vm.settings,vm.example={uSync:{Snapshots:{Enabled:settings.enabled,DisableImport:settings.disableImport,HandlerSet:settings.handlerSet??"default",Folders:settings.folders,Exlude:settings.exclude}}}}),vm.example={}})}(),function(){"use strict";angular.module("umbraco").controller("uSyncSnapshotImportController",function($scope,Upload){var vm=this;vm.upload=function(file){vm.buttonState="busy",Upload.upload({url:Umbraco.Sys.ServerVariables.uSyncSnapshots.snapshotService+"uploadFile",fields:{},file:file}).success(function(data,status,headers,config){vm.buttonState="success",$scope.model.submit&&$scope.model.submit()}).error(function(evt,status,headers,config){vm.buttonState="error"})},vm.handleFiles=function(files,event){files&&0<files.length&&(vm.file=files[0])},vm.close=function(){$scope.model.close&&$scope.model.close()}})}(),function(){"use strict";angular.module("umbraco").factory("uSyncSnapshotService",function($http,umbRequestHelper){var serviceRoot=Umbraco.Sys.ServerVariables.uSyncSnapshots.snapshotService;return{enabled:function(){return $http.get(serviceRoot+"Enabled")},getSnapshots:function(){return $http.get(serviceRoot+"GetSnapshots")},createSnapshot:function(name,includeFolders,groupName,fullSnapshot,clientId){return $http.put(serviceRoot+"CreateSnapshot",{name:name,includeFolders:includeFolders,group:groupName,clientId:clientId,fullSnapshot:fullSnapshot})},report:function(alias,clientId){return $http.get(serviceRoot+"Report/?alias="+alias+"&clientId="+clientId)},reportAll:function(clientId){return $http.get(serviceRoot+"ReportAll/?clientId="+clientId)},apply:function(alias,clientId){return $http.post(serviceRoot+"Apply/",{Alias:alias,clientId:clientId})},applyAll:function(clientId){return $http.post(serviceRoot+"ApplyAll/",{clientId:clientId})},remove:function(alias){return $http.delete(serviceRoot+"Remove/?alias="+alias)},download:function(url){url=serviceRoot+"ZipSnapshot/?alias="+url;return umbRequestHelper.downloadFile(url)},downloadAll:function(){var url=serviceRoot+"ZipAll";return umbRequestHelper.downloadFile(url)},getSettings:function(){return $http.get(serviceRoot+"GetSettings")},saveSettings:function(settings){return $http.post(serviceRoot+"SaveSettings",settings)}}})}(),function(){"use strict";angular.module("umbraco").controller("uSyncSnapshotDashboardController",function($scope,$timeout,eventsService,navigationService){this.selectNavigationItem=function(item){eventsService.emit("usync-snapshot.tab.change",item)},this.page={title:"uSync Snapshots",description:"point in time views of umbraco setup",navigation:[{name:"snapshots",alias:"snapshots",icon:"icon-flash",view:Umbraco.Sys.ServerVariables.umbracoSettings.appPluginsPath+"/uSyncSnapshots/dashboard/default.html",active:!0},{name:"Create",alias:"snapCreate",icon:"icon-add",view:Umbraco.Sys.ServerVariables.umbracoSettings.appPluginsPath+"/uSyncSnapshots/dashboard/create.html"},{name:"settings",alias:"snapsettings",icon:"icon-settings",view:Umbraco.Sys.ServerVariables.umbracoSettings.appPluginsPath+"/uSyncSnapshots/dashboard/settings.html"}]},$timeout(function(){navigationService.syncTree({tree:"uSyncSnapshots",path:"-1"})})})}();
//# sourceMappingURL=usyncsnapshots.9.4.0.min.js.map
